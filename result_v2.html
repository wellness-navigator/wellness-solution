<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²´ì§ˆ MBTI - ë‚˜ë§Œì˜ ì›°ë‹ˆìŠ¤ ìºë¦­í„° ì°¾ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Jua&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* V2 Specific overrides */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f0f4f8;
        }

        .playful-font {
            font-family: 'Jua', sans-serif;
        }

        .mbti-tag-v2 {
            background: #fff;
            color: #333;
            border: 2px solid #333;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 12px;
            box-shadow: 2px 2px 0px #333;
        }

        .hero-title-v2 {
            font-family: 'Jua', sans-serif;
            font-size: 28px;
            text-align: center;
            line-height: 1.4;
            color: #333;
            margin-bottom: 12px;
        }

        .hero-desc-v2 {
            text-align: center;
            color: #666;
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .start-btn-v2 {
            background: #222;
            color: #fff;
            font-family: 'Jua', sans-serif;
            font-size: 20px;
            padding: 20px;
            width: 100%;
            border-radius: 16px;
            border: none;
            box-shadow: 0 4px 0 #555;
            transition: all 0.1s;
            cursor: pointer;
        }

        .start-btn-v2:active {
            box-shadow: 0 2px 0 #555;
            transform: translateY(2px);
        }

        /* Card Result Style */
        .result-card-v2 {
            background: #fff;
            border: 3px solid #333;
            border-radius: 24px;
            padding: 40px 20px;
            text-align: center;
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            position: relative;
        }

        /* Updated Typography for Titles */
        .result-type-title {
            font-family: 'Jua', sans-serif;
            font-size: 24px;
            margin-bottom: 8px;
            display: inline-block;
            padding: 4px 12px;
            border-radius: 8px;
        }

        .result-char-name {
            font-family: 'Jua', sans-serif;
            font-size: 28px;
            margin-bottom: 8px;
            color: #333;
            line-height: 1.3;
        }

        .char-icon-large {
            width: 140px;
            height: 140px;
            background: #f8f9fa;
            border-radius: 50%;
            margin: 0 auto 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            border: 4px solid #333;
        }

        .keyword-badge {
            display: inline-block;
            padding: 8px 20px;
            background: #333;
            color: #fff;
            border-radius: 30px;
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .participant-count {
            text-align: center;
            margin: 30px 0;
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 12px;
        }

        .participant-count strong {
            font-size: 32px;
            font-weight: 800;
            color: #333;
            font-family: 'Jua', sans-serif;
        }

        /* Shared Quiz Styles */
        .progress-container {
            width: 100%;
            height: 6px;
            background: #eee;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 999;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: #222;
            width: 0%;
            transition: width 0.3s ease;
        }

        #quiz-section {
            display: none;
            padding-top: 60px;
        }

        #result-section {
            display: none;
        }

        /* ... existing quiz styles ... */
        .question-card {
            padding: 24px;
            text-align: center;
            margin-top: 20px;
        }

        .question-number {
            color: #888;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 30px;
            line-height: 1.4;
            font-family: 'Jua', sans-serif;
        }

        .option-btn {
            width: 100%;
            padding: 18px;
            margin-bottom: 12px;
            border: 2px solid #eee;
            border-radius: 12px;
            background: #fff;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
        }

        .option-btn:hover {
            border-color: #333;
            background: #f9f9f9;
        }

        .partner-box {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px;
            margin-top: 30px;
            text-align: left;
            border: 2px dashed #ddd;
        }

        .partner-title {
            font-size: 14px;
            color: #888;
            margin-bottom: 8px;
            font-weight: 700;
            display: flex;
            align-items: center;
        }

        .partner-name {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .partner-reason {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        /* Ranking Table */
        .ranking-container {
            background: #fff;
            padding: 24px;
            border-radius: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .ranking-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
        }

        .rank-row {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .rank-num {
            width: 30px;
            font-weight: 700;
            color: #888;
        }

        .rank-name {
            flex: 1;
            font-size: 15px;
            color: #444;
        }

        .rank-score {
            font-weight: 700;
            color: #333;
        }

        .rank-row.rank-1 {
            background: #fff5f5;
            border-radius: 8px;
            padding: 12px 10px;
            border: none;
            margin-bottom: 10px;
        }

        .rank-row.rank-1 .rank-num {
            color: #ff5252;
        }

        .rank-row.rank-1 .rank-name {
            font-weight: 700;
            color: #222;
        }

        /* 3 Bottom Action Buttons */
        .action-btn-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
        }

        .action-btn {
            width: 100%;
            padding: 24px 20px;
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
            text-decoration: none;
            display: block;
            box-sizing: border-box;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .action-btn:active {
            transform: scale(0.98);
        }

        /* 1. Share Button (Soft Blue/Main Color) */
        .btn-share {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1565c0;
            border: 1px solid #90caf9;
        }

        /* 2. Retry Button (White) */
        .btn-retry {
            background: #fff;
            color: #444;
            border: 1px solid #ddd;
        }

        /* 3. AI Link Button (Light Purple or similar) */
        .btn-ai {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            color: #7b1fa2;
            border: 1px solid #ce93d8;
        }

        .action-title {
            font-size: 17px;
            font-weight: 700;
            margin-bottom: 4px;
            font-family: 'Jua', sans-serif;
        }

        .action-sub {
            font-size: 13px;
            font-weight: 400;
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <div class="mobile-container" style="background: linear-gradient(180deg, #e3f2fd 0%, #fff 100%); min-height:100vh;">

        <div class="progress-container" id="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <!-- === INTRO SECTION === -->
        <div id="intro-section">
            <div style="padding: 40px 24px;">
                <div style="text-align:center;">
                    <span class="mbti-tag-v2">New 2026 Trend</span>
                    <h1 class="hero-title-v2">2026ë…„í˜• ê±´ê°• ê´€ë¦¬<br>'ì²´ì§ˆ MBTI' í…ŒìŠ¤íŠ¸</h1>
                    <p class="hero-desc-v2">
                        ì„±ê²© MBTIë¡œ ë‚˜ë¥¼ ì´í•´í•˜ë“¯,<br>
                        <strong>DNA ì„¤ê³„ë„</strong>ë¡œ ë‚´ ëª¸ì„ ì•Œì•„ë³´ì„¸ìš”!
                    </p>
                </div>

                <div style="margin: 20px 0; text-align: center;">
                    <img src="v2_cards.png" alt="8 Constitution Icons"
                        style="width: 100%; max-width: 320px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.08);">
                </div>

                <div class="participant-count">
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">í˜„ì¬ ì°¸ì—¬ ì¸ì›</div>
                    <strong>1,210ëª…</strong><br>
                    <span style="font-size: 12px; color: #888;">ë‚˜ì˜ ì›°ë‹ˆìŠ¤ ì•„ì´ì½˜ì€ ë¬´ì—‡ì¼ê¹Œìš”?</span>
                </div>

                <button id="btn-start-quiz" class="start-btn-v2">
                    ë‚˜ì˜ ì›°ë‹ˆìŠ¤ ì•„ì´ì½˜ í™•ì¸í•˜ê¸° <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- === QUIZ SECTION === -->
        <div id="quiz-section">
            <div id="question-container"></div>
        </div>

        <!-- === RESULT SECTION === -->
        <div id="result-section" style="padding: 40px 24px;">
            <div class="result-card-v2" id="v2-result-card">
                <!-- Highlighted Type Name (Larger) -->
                <div id="v2-type-name" class="result-type-title">Analyzing...</div>

                <!-- Character Name (Similar Size) -->
                <h2 id="v2-char-name" class="result-char-name">ë¶„ì„ì¤‘</h2>

                <div style="font-size:14px; color:#888; margin-bottom:24px;" id="v2-char-sub">ì•„ì´ì½˜ ì˜ë¯¸ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤</div>

                <div class="char-icon-large" id="v2-icon-bg">
                    <i class="fa-solid fa-user" id="v2-icon-el"></i>
                </div>

                <div class="keyword-badge" id="v2-keyword">#í‚¤ì›Œë“œ</div>

                <p id="v2-desc" style="line-height: 1.6; color: #555; margin-top: 10px;">
                    ê²°ê³¼ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...
                </p>

                <div class="partner-box">
                    <div class="partner-title">âœ¨ Best Partner (ìƒí˜¸ë³´ì™„)</div>
                    <div class="partner-name" id="v2-partner">ë¡œë”©ì¤‘</div>
                    <div class="partner-reason" id="v2-partner-reason"></div>
                </div>

                <div style="margin-top:24px; text-align:left; background:#fff3e0; padding:16px; border-radius:12px;">
                    <div style="font-size:14px; font-weight:700; color:#ef6c00; margin-bottom:6px;">
                        <i class="fa-solid fa-triangle-exclamation"></i> ìƒí™œ ì† ì£¼ì˜ì‚¬í•­
                    </div>
                    <p id="v2-caution" style="font-size:13px; color:#5d4037; margin:0; line-height:1.4;">
                        ì£¼ì˜ì‚¬í•­ í…ìŠ¤íŠ¸
                    </p>
                </div>

                <!-- Food Therapy Section (V2) -->
                <div style="margin-top:16px; text-align:left; background:#e8f5e9; padding:16px; border-radius:12px;">
                    <div style="font-size:14px; font-weight:700; color:#2e7d32; margin-bottom:6px;">
                        <i class="fa-solid fa-carrot"></i> ë‚´ ëª¸ì— ë§ëŠ” í‘¸ë“œ í…Œë¼í”¼
                    </div>
                    <div id="v2-food-list" style="font-size:13px; color:#1b5e20; margin:0; line-height:1.6;">
                        <!-- Food list will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Ranking List -->
            <div class="ranking-container">
                <div class="ranking-title">ğŸ“‹ ë‚˜ì˜ ì²´ì§ˆ ë¶„ì„ ìˆœìœ„</div>
                <div style="font-size:13px; color:#888; margin-bottom:15px; margin-top:-10px;">
                    <i class="fa-solid fa-circle-info"></i> ì ìˆ˜ê°€ ë†’ì€ ìˆœìœ¼ë¡œ ë‚˜ì—´ë©ë‹ˆë‹¤.
                </div>
                <div id="v2-ranking-list"></div>
            </div>

            <!-- 3 Bottom Action Buttons -->
            <div class="action-btn-group">
                <!-- 1. Share -->
                <div class="action-btn btn-share" onclick="shareResult()">
                    <div class="action-title">í˜¹ì‹œ ë‚´ ì¹œêµ¬ê°€ ë‚˜ë¥¼ ë³´ì™„í•´ì¤„ ì²´ì§ˆ? ğŸ”</div>
                    <div class="action-sub">ë‚˜ì˜ ê±´ê°• MBTIë¥¼ ì•Œë ¤ì£¼ì„¸ìš”!</div>
                </div>

                <!-- 1-2. Save Image -->
                <div class="action-btn" style="background:#fff; color:#333; border:2px solid #333;"
                    onclick="saveV2Image()">
                    <div class="action-title"><i class="fa-solid fa-camera"></i> ê²°ê³¼ ì¹´ë“œ ì €ì¥í•˜ê¸°</div>
                    <div class="action-sub">ê°¤ëŸ¬ë¦¬ì— ì†Œì¥í•˜ì„¸ìš”</div>
                </div>

                <!-- 2. Retry -->
                <div class="action-btn btn-retry" onclick="location.href='result_v2.html'">
                    <div class="action-title"><i class="fa-solid fa-rotate-right"></i> ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°</div>
                </div>

                <!-- 3. AI Diagnosis Link -->
                <a href="index.html" class="action-btn btn-ai">
                    <div class="action-title">'AI ë©€í‹°ëª¨ë‹¬' 2ì°¨ ì²´ì§ˆ ì§„ë‹¨ ê°€ê¸° <i class="fa-solid fa-chevron-right"></i></div>
                    <div class="action-sub">ë” ì •í™•í•œ ì§„ë‹¨ì„ ì›í•˜ì‹œë‚˜ìš”?</div>
                </a>
            </div>

            <div style="text-align:center; margin-top:30px;">
                <a href="index.html" style="color:#aaa; text-decoration:underline; font-size:13px;">ë©”ì¸ìœ¼ë¡œ</a>
            </div>

            <div style="text-align:center; margin-top:40px; font-size:11px; color:#aaa; line-height:1.4;">
                * ë³¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼ëŠ” 8ì²´ì§ˆ ìê°€ì§„ë‹¨ì„ ìœ„í•œ ì°¸ê³ ìš©ì´ë©°,<br>ì •í™•í•œ ì˜í•™ì  ì§„ë‹¨ì€ í•œì˜ì‚¬ì™€ ìƒë‹´ì´ í•„ìš”í•©ë‹ˆë‹¤.
            </div>
        </div>

    </div>

    <script>
        console.log("Quiz V2 Script Loaded");
        const questions = [
            // --- 1. ì²´í˜• ë° ì™¸ëª¨ (Body Shape & Appearance) ---
            {
                id: 1,
                text: "ë‹¹ì‹ ì˜ ì²´ê²©ê³¼ ê·¼ìœ¡ ë°œë‹¬ ì •ë„ëŠ” ì–´ë–¤ê°€ìš”?",
                options: [
                    { text: "ì²´ê²©ì´ í¬ê³  ê·¼ìœ¡ë³´ë‹¤ ì‚´ì´ ì°Œê¸° ì‰¬ìš´ í¸ì´ë‹¤.", scores: { mokyang: 3, mokeum: 3, to: 1 } }, // mokeum 2 -> 3
                    { text: "ìƒì²´ê°€ ë°œë‹¬í–ˆê³ , í•˜ì²´ëŠ” ìƒëŒ€ì ìœ¼ë¡œ ì•½í•˜ë‹¤.", scores: { to: 3, geum: 2 } },
                    { text: "í—ˆë¦¬ê°€ ê°€ëŠ˜ê³  ê· í˜• ì¡í˜€ ìˆìœ¼ë©°, ë§ˆë¥¸ í¸ì´ë‹¤.", scores: { su: 3, geum: 1 } },
                    { text: "ì „ì²´ì ìœ¼ë¡œ ê³¨ê²©ì´ í¬ì§€ ì•Šê³  ë‹¨ë‹¨í•´ ë³´ì¸ë‹¤.", scores: { su: 2, mokeum: 1.5 } } // mokeum 1 -> 1.5
                ]
            },
            {
                id: 2,
                text: "ë•€ì„ í˜ë¦´ ë•Œì˜ ì»¨ë””ì…˜ ë³€í™”ëŠ”?",
                options: [
                    { text: "ë•€ì„ í˜ë¦¬ë©´ ëª¸ì´ ê°œìš´í•˜ê³  ê°€ë³ë‹¤.", scores: { mokyang: 4, mokeum: 4.5, to: 1 } }, // mokeum 3 -> 4.5
                    { text: "í‰ì†Œ ë•€ì´ ë³„ë¡œ ì—†ê±°ë‚˜, í˜ë ¤ë„ í° ë³€í™” ì—†ë‹¤.", scores: { to: 1, geum: 1 } },
                    { text: "ë•€ì„ í˜ë¦¬ë©´ ê¸°ìš´ì´ ë¹ ì§€ê³  ì‰½ê²Œ ì§€ì¹œë‹¤.", scores: { su: 4, geum: 2 } },
                    { text: "ì ì˜ ë•Œ ì‹ì€ë•€ì´ ë‚˜ë©´ ëª¸ì´ ì•ˆ ì¢‹ë‹¤.", scores: { su: 3 } }
                ]
            },

            // --- 2. ì‹ìŠµê´€ ë° ì†Œí™” (Diet & Digestion) ---
            {
                id: 3,
                text: "ìœ¡ì‹(ì†Œê³ ê¸°, ë‹­ê³ ê¸° ë“±)ì„ ë¨¹ì—ˆì„ ë•Œ ë°˜ì‘ì€?",
                options: [
                    { text: "ì†Œí™”ê°€ ì•„ì£¼ ì˜ ë˜ê³  í˜ì´ ë‚œë‹¤.", scores: { mokyang: 4, mokeum: 6, to: 2 } }, // mokeum 4 -> 6
                    { text: "ê°€ë” ë¨¹ìœ¼ë©´ ì¢‹ì§€ë§Œ, ê³¼í•˜ë©´ ì†ì´ ë¶ˆí¸í•˜ë‹¤.", scores: { su: 2, to: 2 } },
                    { text: "ê³ ê¸°ë¥¼ ë¨¹ìœ¼ë©´ ì†ì´ ë”ë¶€ë£©í•˜ê³  ë³€ì´ ë¬½ì–´ì§„ë‹¤.", scores: { geumyang: 4, geumeum: 6 } }, // geumeum 4 -> 6
                    { text: "ë³„ë‹¤ë¥¸ ì˜í–¥ ì—†ì´ ë¬´ë‚œí•˜ë‹¤.", scores: { su: 1 } }
                ]
            },
            {
                id: 4,
                text: "í•´ì‚°ë¬¼(ìƒì„ , ì¡°ê°œë¥˜)ì„ ë¨¹ì—ˆì„ ë•Œ ë°˜ì‘ì€?",
                options: [
                    { text: "ë§¤ìš° í¸ì•ˆí•˜ê³  ì†Œí™”ê°€ ì˜ ëœë‹¤.", scores: { geumyang: 4, geumeum: 6, to: 2 } }, // geumeum 4 -> 6
                    { text: "ì¢‹ì•„í•˜ì§€ë§Œ ê°€ë” ë¹„ë¦°ë‚´ê°€ ì—­í•˜ê²Œ ëŠê»´ì§„ë‹¤.", scores: { su: 2 } },
                    { text: "ìƒì„ ì´ë‚˜ ì¡°ê°œë¥¼ ë¨¹ìœ¼ë©´ ì•ŒëŸ¬ì§€ê°€ ìƒê¸°ê±°ë‚˜ ì†Œí™”ê°€ ì•ˆ ëœë‹¤.", scores: { mokyang: 4, mokeum: 4.5 } }, // mokeum 3 -> 4.5
                    { text: "íšŒë³´ë‹¤ëŠ” ìµí˜€ ë¨¹ëŠ” ê²ƒì´ í¸í•˜ë‹¤.", scores: { su: 3, mokyang: 1 } }
                ]
            },
            {
                id: 5,
                text: "ì°¬ ìŒì‹(ëƒ‰ë©´, ì–¼ìŒë¬¼, ì°¸ì™¸ ë“±)ì„ ë¨¹ìœ¼ë©´?",
                options: [
                    { text: "ì‹œì›í•˜ê³  ì†ì´ ë»¥ ëš«ë¦¬ëŠ” ê¸°ë¶„ì´ë‹¤.", scores: { to: 4, geum: 2, mokyang: 1 } },
                    { text: "ë³„ ìƒê´€ì—†ë‹¤.", scores: { mokyang: 1, to: 1 } },
                    { text: "ë°°ê°€ ì•„í”„ê±°ë‚˜ ì„¤ì‚¬ë¥¼ í•˜ê¸°ë„ í•œë‹¤.", scores: { su: 4, mokeum: 4.5 } }, // mokeum 3 -> 4.5
                    { text: "ì†Œí™”ê°€ ì•ˆ ë˜ì–´ ë”°ëœ»í•œ ê²ƒë§Œ ì°¾ê²Œ ëœë‹¤.", scores: { su: 4, mokeum: 3 } } // mokeum 2 -> 3
                ]
            },
            {
                id: 6,
                text: "ë°€ê°€ë£¨ ìŒì‹(ë¹µ, êµ­ìˆ˜)ì— ëŒ€í•œ ë°˜ì‘ì€?",
                options: [
                    { text: "ì†Œí™”ê°€ ì˜ ë˜ê³  ì¦ê²¨ ë¨¹ëŠ”ë‹¤.", scores: { mokyang: 3, mokeum: 4.5, to: 2 } }, // mokeum 3 -> 4.5
                    { text: "ë¨¹ê³  ë‚˜ë©´ ì†ì´ ë”ë¶€ë£©í•˜ê³  ê°€ìŠ¤ê°€ ì°¬ë‹¤.", scores: { su: 3, geum: 2 } },
                    { text: "í”¼ë¶€ íŠ¸ëŸ¬ë¸”ì´ ì˜ ìƒê¸´ë‹¤.", scores: { geum: 3, to: 1 } },
                    { text: "í¬ê²Œ ë¶ˆí¸í•¨ ì—†ë‹¤.", scores: { mokyang: 1 } }
                ]
            },
            {
                id: 7,
                text: "ë§¤ìš´ ìŒì‹ì„ ë¨¹ì—ˆì„ ë•ŒëŠ” ì–´ë–¤ê°€ìš”?",
                options: [
                    { text: "ìŠ¤íŠ¸ë ˆìŠ¤ê°€ í’€ë¦¬ê³  ì†Œí™”ê°€ ì˜ ëœë‹¤.", scores: { su: 3, mokyang: 2 } },
                    { text: "ì„¤ì‚¬ë¥¼ í•˜ê±°ë‚˜ ì†ì´ ì“°ë¦¬ë‹¤.", scores: { to: 4, geum: 2 } },
                    { text: "ë•€ì´ ë„ˆë¬´ ë§ì´ ë‚˜ì„œ í˜ë“¤ë‹¤.", scores: { to: 2, mokyang: 1 } },
                    { text: "ì ë‹¹íˆ ì¦ê¸°ëŠ” í¸ì´ë‹¤.", scores: { mokeum: 1.5 } } // mokeum 1 -> 1.5
                ]
            },
            {
                id: 8,
                text: "ì‹ì‚¬ ì†ë„ëŠ” ì–´ë–¤ í¸ì¸ê°€ìš”?",
                options: [
                    { text: "ë§¤ìš° ë¹ ë¥´ë‹¤. ì‹íƒì´ ì¡°ê¸ˆ ìˆëŠ” í¸ì´ë‹¤.", scores: { to: 4, mokyang: 2 } },
                    { text: "ë³´í†µì´ë‹¤.", scores: { mokeum: 1.5, geum: 1 } }, // mokeum 1 -> 1.5
                    { text: "ì²œì²œíˆ ë¨¹ëŠ” í¸ì´ë‹¤.", scores: { su: 2, geumeum: 3 } }, // geumeum 2 -> 3
                    { text: "ì†Œí™”ê°€ ì•ˆ ë¼ì„œ ì•„ì£¼ ì²œì²œíˆ ê¼­ê¼­ ì”¹ì–´ ë¨¹ëŠ”ë‹¤.", scores: { su: 4 } }
                ]
            },

            // --- 3. ë³‘ë¦¬ ë° ë¯¼ê°ë„ (Pathology & Sensitivity) ---
            {
                id: 9,
                text: "ì•½ë¬¼(í•­ìƒì œ, ì§„í†µì œ)ì— ëŒ€í•œ ë¶€ì‘ìš© ê²½í—˜ì´ ìˆë‚˜ìš”?",
                options: [
                    { text: "ê±°ì˜ ì—†ë‹¤. ì•½ë°œì´ ì˜ ë°›ëŠ”ë‹¤.", scores: { mokyang: 2, mokeum: 3 } }, // mokeum 2 -> 3
                    { text: "ê°€ë” ì†ì´ ì“°ë¦¬ë‹¤.", scores: { su: 1 } },
                    { text: "ì•½ ë¶€ì‘ìš©ì´ ì‹¬í•´ í•œì•½ì´ë‚˜ ìì—°ìš”ë²•ì„ ì„ í˜¸í•œë‹¤.", scores: { toeum: 7.5, geumyang: 3 } }, // toeum 5 -> 7.5
                    { text: "íŠ¹ë³„íˆ ëª¨ë¥´ê² ë‹¤.", scores: { to: 1 } }
                ]
            },
            {
                id: 10,
                text: "ì»¤í”¼ë¥¼ ë§ˆì‹œë©´ ì–´ë–¤ê°€ìš”?",
                options: [
                    { text: "í”¼ë¡œê°€ í’€ë¦¬ê³  ì§‘ì¤‘ì´ ì˜ ëœë‹¤.", scores: { mokyang: 2, mokeum: 3, to: 2 } }, // mokeum 2 -> 3
                    { text: "ê°€ìŠ´ì´ ë‘ê·¼ê±°ë¦¬ê³  ì ì´ ì•ˆ ì˜¨ë‹¤.", scores: { geum: 3, toeum: 4.5 } }, // toeum 3 -> 4.5
                    { text: "ì†ì´ ì“°ë¦¬ë‹¤.", scores: { su: 2 } },
                    { text: "í•˜ë£¨ 3ì” ì´ìƒ ë§ˆì…”ë„ ê´œì°®ë‹¤.", scores: { mokyang: 3, to: 1 } }
                ]
            },
            {
                id: 11,
                text: "ì‚¬ìš°ë‚˜ë‚˜ ëœ¨ê±°ìš´ ëª©ìš•ì„ ì¢‹ì•„í•˜ì‹œë‚˜ìš”?",
                options: [
                    { text: "ì•„ì£¼ ì¢‹ì•„í•œë‹¤. ë•€ ë¹¼ë©´ ê°œìš´í•˜ë‹¤.", scores: { mokyang: 4, mokeum: 4.5 } }, // mokeum 3 -> 4.5
                    { text: "ë‹µë‹µí•´ì„œ ì˜¤ë˜ ëª» ìˆëŠ”ë‹¤.", scores: { to: 2, geum: 2 } },
                    { text: "í•˜ê³  ë‚˜ë©´ ì–´ì§€ëŸ½ê³  ê¸°ìš´ì´ ë¹ ì§„ë‹¤.", scores: { su: 4, geum: 3 } },
                    { text: "ë”°ëœ»í•œ ë¬¼ì— ë°˜ì‹ ìš• ì •ë„ê°€ ì¢‹ë‹¤.", scores: { su: 2 } }
                ]
            },

            // --- 4. ì„±ê²© ë° ê¸°ì§ˆ (Personality) ---
            {
                id: 12,
                text: "ë‹¹ì‹ ì˜ ì„±ê²© ìŠ¤íƒ€ì¼ì€?",
                options: [
                    { text: "ëŠê¸‹í•˜ê³  ê³¼ë¬µí•˜ë©°, ë‘¥ê¸€ë‘¥ê¸€ë‹¤.", scores: { mokyang: 3 } },
                    { text: "ê¸‰í•˜ê³  í™œë‹¬í•˜ë©°, ë’¤ëì´ ì—†ë‹¤.", scores: { to: 4 } },
                    { text: "ì„¬ì„¸í•˜ê³  ê¼¼ê¼¼í•˜ë©°, ì˜ì‹¬ì´ ë§ë‹¤.", scores: { su: 4, geumeum: 3 } }, // geumeum 2 -> 3
                    { text: "ì§ê´€ì ì´ê³  ì°½ì˜ì ì´ë‚˜, ë¹„í˜„ì‹¤ì ì¼ ë•Œê°€ ìˆë‹¤.", scores: { geumyang: 3 } }
                ]
            },
            {
                id: 13,
                text: "í™”ê°€ ë‚¬ì„ ë•Œì˜ ë°˜ì‘ì€?",
                options: [
                    { text: "ì°¸ë‹¤ê°€ í•œ ë²ˆì— í­ë°œí•œë‹¤.", scores: { mokyang: 2, su: 2 } },
                    { text: "ë°”ë¡œë°”ë¡œ í‘œí˜„í•˜ê³  ê¸ˆë°© ìŠëŠ”ë‹¤.", scores: { to: 4, mokeum: 3 } }, // mokeum 2 -> 3
                    { text: "í™”ë¥¼ ë‚´ë©´ ëª¸ì´ ì•„í”Œ ì •ë„ë¡œ íƒ€ê²©ì„ ì…ëŠ”ë‹¤.", scores: { geumeum: 6 } }, // geumeum 4 -> 6
                    { text: "ë…¼ë¦¬ì ìœ¼ë¡œ ë”°ì§€ê³  ë“ ë‹¤.", scores: { geum: 2, su: 1 } }
                ]
            },
            {
                id: 14,
                text: "ë§í•˜ê¸°ë¥¼ ì¢‹ì•„í•˜ë‚˜ìš”?",
                options: [
                    { text: "ë§í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•˜ê³  ëª©ì†Œë¦¬ê°€ í†¤ì´ ë†’ë‹¤.", scores: { to: 3, mokeum: 4.5 } }, // mokeum 3 -> 4.5
                    { text: "ë§í•˜ê¸°ë³´ë‹¤ëŠ” ë“£ëŠ” í¸ì´ë‹¤.", scores: { mokyang: 2, su: 2 } },
                    { text: "ë§ì„ ë§ì´ í•˜ë©´ í”¼ê³¤í•˜ë‹¤.", scores: { geum: 2, su: 3 } },
                    { text: "ë…¼ìŸí•˜ëŠ” ê²ƒì„ ì¦ê¸´ë‹¤.", scores: { geumeum: 4.5 } } // geumeum 3 -> 4.5
                ]
            },

            // --- 5. ìˆ˜ë©´ ë° ê¸°íƒ€ (Sleep & Others) ---
            {
                id: 15,
                text: "ì ê·€ê°€ ë°ì€ í¸ì¸ê°€ìš”?",
                options: [
                    { text: "ë§¤ìš° ì˜ˆë¯¼í•´ì„œ ì‘ì€ ì†Œë¦¬ì—ë„ ê¹¬ë‹¤.", scores: { su: 3, geum: 2 } },
                    { text: "í•œë²ˆ ì ë“¤ë©´ ì—…ì–´ê°€ë„ ëª¨ë¥¸ë‹¤.", scores: { mokyang: 4, to: 2 } },
                    { text: "ê¿ˆì„ ìì£¼ ê¾¸ëŠ” í¸ì´ë‹¤.", scores: { mokeum: 3 } }, // mokeum 2 -> 3
                    { text: "ì ìë¦¬ê°€ ë°”ë€Œë©´ ì˜ ëª» ì”ë‹¤.", scores: { su: 3 } }
                ]
            },
            {
                id: 16,
                text: "í”¼ë¶€ ìƒíƒœëŠ” ì–´ë–¤ê°€ìš”?",
                options: [
                    { text: "í¬ê³  ë¶€ë“œëŸ¬ìš°ë‚˜ ì•Œë ˆë¥´ê¸°/ì•„í† í”¼ê°€ ì¦ë‹¤.", scores: { geum: 4 } },
                    { text: "ë•€êµ¬ë©ì´ í¬ê³  ì¹™ì¹™í•œ í¸ì´ë‹¤.", scores: { mokyang: 2 } },
                    { text: "ê±´ì¡°í•˜ê³  ì–‡ì€ í¸ì´ë‹¤.", scores: { to: 2, su: 1 } },
                    { text: "íŠ¹ë³„í•œ íŠ¸ëŸ¬ë¸” ì—†ì´ ê±´ê°•í•˜ë‹¤.", scores: { su: 1, mokeum: 1.5 } } // mokeum 1 -> 1.5
                ]
            },
            {
                id: 17,
                text: "ì˜¤ë¥¸ìª½ ë°°(ê°„ ë¶€ìœ„)ê°€ ë¶ˆí¸í•œ ì ì´ ìˆë‚˜ìš”?",
                options: [
                    { text: "ìì£¼ ë»ê·¼í•˜ê±°ë‚˜ ë¶ˆí¸í•˜ë‹¤.", scores: { geumyang: 3, geumeum: 4.5 } }, // geumeum 3 -> 4.5
                    { text: "ìˆ ì„ ë§ˆì…”ë„ ê°„ì€ íŠ¼íŠ¼í•œ ê²ƒ ê°™ë‹¤.", scores: { mokyang: 3, mokeum: 4.5 } }, // mokeum 3 -> 4.5
                    { text: "ì „í˜€ ëª¨ë¥´ê² ë‹¤.", scores: { to: 1, su: 1 } },
                    { text: "ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ìœ¼ë©´ ì˜†êµ¬ë¦¬ê°€ ê²°ë¦°ë‹¤.", scores: { mokeum: 3 } } // mokeum 2 -> 3
                ]
            },
            {
                id: 18,
                text: "í‰ì†Œ ë¬¼ì„ ë§ˆì‹œëŠ” ìŠµê´€ì€?",
                options: [
                    { text: "ë¬¼ì„ ì˜ ì•ˆ ë§ˆì‹ ë‹¤. ê°ˆì¦ì„ ë³„ë¡œ ì•ˆ ëŠë‚€ë‹¤.", scores: { su: 3, mokyang: 1 } },
                    { text: "ì‹œì›í•œ ë¬¼ì„ ë²Œì»¥ë²Œì»¥ ìì£¼ ë§ˆì‹ ë‹¤.", scores: { to: 4, geum: 2 } },
                    { text: "ë”°ëœ»í•œ ì°¨ë¥¼ ì¦ê²¨ ë§ˆì‹ ë‹¤.", scores: { su: 3 } },
                    { text: "ì‹ì‚¬ ë„ì¤‘ ë¬¼ì„ ë§ì´ ë§ˆì‹ ë‹¤.", scores: { mokeum: 3 } } // mokeum 2 -> 3
                ]
            },
            {
                id: 19,
                text: "ê°€ì¥ ìì£¼ ì•“ëŠ” ì¦ìƒì€?",
                options: [
                    { text: "ì†Œí™”ë¶ˆëŸ‰, ìœ„ì—¼, ì†ì“°ë¦¼.", scores: { su: 3, mokeum: 3 } }, // mokeum 2 -> 3
                    { text: "ì•„í† í”¼, ë¹„ì—¼, í”¼ë¶€ì§ˆí™˜.", scores: { geum: 4 } },
                    { text: "ìš”í†µ, ê´€ì ˆí†µ.", scores: { mokyang: 2 } },
                    { text: "ë‘í†µ, ì–´ì§€ëŸ¼ì¦.", scores: { toeum: 3 } } // toeum 2 -> 3
                ]
            },
            {
                id: 20,
                text: "ìƒˆë¡œìš´ í™˜ê²½ì— ì ì‘í•˜ëŠ” ëŠ¥ë ¥ì€?",
                options: [
                    { text: "ë¹ ë¥´ê²Œ ì ì‘í•˜ê³  ì‚¬ëŒë“¤ê³¼ ê¸ˆë°© ì¹œí•´ì§„ë‹¤.", scores: { to: 4, mokeum: 4.5 } }, // mokeum 3 -> 4.5
                    { text: "ì‹œê°„ì´ ê±¸ë¦¬ì§€ë§Œ í•œë²ˆ ì ì‘í•˜ë©´ ê¾¸ì¤€í•˜ë‹¤.", scores: { mokyang: 3 } },
                    { text: "ë‚¯ì„ ê°€ë¦¬ê³  í˜¼ì ìˆëŠ” ê²ƒì´ í¸í•˜ë‹¤.", scores: { su: 3, geum: 2 } },
                    { text: "ì£¼ë„ì ìœ¼ë¡œ ë¶„ìœ„ê¸°ë¥¼ ì´ëˆë‹¤.", scores: { geumeum: 4.5 } } // geumeum 3 -> 4.5
                ]
            },
            // --- 6. ì¶”ê°€ ì§ˆë¬¸ (ìŒì²´ì§ˆ ë³´ê°•) ---
            {
                id: 21,
                text: "í‰ì†Œ ì¶”ìœ„ë¥¼ ë§ì´ íƒ€ê±°ë‚˜ ì†ë°œì´ ì°¨ê°€ìš´ í¸ì¸ê°€ìš”?",
                options: [
                    { text: "ë§¤ìš° ê·¸ë ‡ë‹¤. ê²¨ìš¸ì´ í˜ë“¤ë‹¤.", scores: { sueum: 6, geumeum: 4 } },
                    { text: "ê°€ë” ê·¸ë ‡ì§€ë§Œ ê²¬ë”œë§Œí•˜ë‹¤.", scores: { sueum: 3, mokeum: 2 } },
                    { text: "ì¶”ìœ„ë³´ë‹¤ëŠ” ë”ìœ„ë¥¼ ë§ì´ íƒ„ë‹¤.", scores: { toyang: 2, mokyang: 2 } },
                    { text: "íŠ¹ë³„íˆ ì¶”ìœ„ë‚˜ ë”ìœ„ë¥¼ íƒ€ì§€ ì•ŠëŠ”ë‹¤.", scores: { mokyang: 1 } }
                ]
            },
            {
                id: 22,
                text: "ì§€ì¹˜ê³  í˜ë“¤ ë•Œ ì—ë„ˆì§€ë¥¼ íšŒë³µí•˜ëŠ” ë°©ë²•ì€?",
                options: [
                    { text: "ì§‘ì—ì„œ í˜¼ì ì¡°ìš©íˆ ì‰¬ëŠ” ê²ƒì´ ìµœê³ ë‹¤.", scores: { sueum: 5, mokeum: 4, geumeum: 3 } },
                    { text: "ì¹œí•œ ì¹œêµ¬ í•œë‘ ëª…ê³¼ ê¹Šì€ ëŒ€í™”ë¥¼ ë‚˜ëˆˆë‹¤.", scores: { geumeum: 3, sueum: 2 } },
                    { text: "ì‚¬ëŒë“¤ì„ ë§Œë‚˜ ì™ìì§€ê»„í•˜ê²Œ ë†€ì•„ì•¼ í’€ë¦°ë‹¤.", scores: { toyang: 4, mokyang: 3 } },
                    { text: "ìš´ë™ì„ í•˜ê±°ë‚˜ ëª¸ì„ ì›€ì§ì—¬ ë•€ì„ ë‚¸ë‹¤.", scores: { mokyang: 3, mokeum: 2 } } // mokeum maintained 2 as base
                ]
            },
            {
                id: 23,
                text: "ì‹ ê²½ì„ ì“°ê±°ë‚˜ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ìœ¼ë©´ ì†Œí™”ê°€ ì•ˆ ë˜ë‚˜ìš”?",
                options: [
                    { text: "ìì£¼ ì²´í•˜ê±°ë‚˜ ëª…ì¹˜ê°€ ë‹µë‹µí•´ì§„ë‹¤.", scores: { sueum: 5, geumeum: 5 } },
                    { text: "ì…ë§›ì´ ëš ë–¨ì–´ì§„ë‹¤.", scores: { toeum: 4, geumyang: 3 } },
                    { text: "ì˜¤íˆë ¤ ë¨¹ëŠ” ê²ƒìœ¼ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í‘¼ë‹¤.", scores: { mokyang: 4, toyang: 3 } },
                    { text: "ìŠ¤íŠ¸ë ˆìŠ¤ì™€ ì†Œí™”ëŠ” ë³„ ìƒê´€ì´ ì—†ë‹¤.", scores: { mokyang: 2 } }
                ]
            }
        ];

        // --- ì ìˆ˜ ì§‘ê³„ ê°ì²´ ---
        let scores = {
            mokyang: 0,
            mokeum: 0,
            toyang: 0,
            toeum: 0, // Rare
            geumyang: 0,
            geumeum: 0,
            suyang: 0,
            sueum: 0
        };

        // ë§¤í•‘: ë‹¨ì¶•í‚¤ -> ì‹¤ì œ ID
        const keyMap = {
            'mokyang': 'mokyang', 'mok': 'mokyang',
            'mokeum': 'mokeum',
            'toyang': 'toyang', 'to': 'toyang',
            'toeum': 'toeum',
            'geumyang': 'geumyang', 'geum': 'geumyang',
            'geumeum': 'geumeum',
            'suyang': 'suyang', 'su': 'suyang',
            'sueum': 'sueum'
        };

        // ì²´ì§ˆ í‘œì‹œ ì´ë¦„
        const constitutionNames = {
            mokyang: 'ëª©ì–‘ì²´ì§ˆ', mokeum: 'ëª©ìŒì²´ì§ˆ',
            toyang: 'í† ì–‘ì²´ì§ˆ', toeum: 'í† ìŒì²´ì§ˆ',
            geumyang: 'ê¸ˆì–‘ì²´ì§ˆ', geumeum: 'ê¸ˆìŒì²´ì§ˆ',
            suyang: 'ìˆ˜ì–‘ì²´ì§ˆ', sueum: 'ìˆ˜ìŒì²´ì§ˆ'
        };

        let currentQuestionIndex = 0;
        // ê²€ì¦ ë‹¨ê³„ ìƒíƒœ: 'NONE' | 'ASK_KNOW' | 'ASK_WHICH'
        let verificationState = 'NONE';

        // ë¬¸ì œ ë¡œë“œ
        function loadQuestion() {
            // ëª¨ë“  ì¼ë°˜ ì§ˆë¬¸ì´ ëë‚¬ì„ ë•Œ
            if (currentQuestionIndex >= questions.length) {
                if (verificationState === 'NONE') {
                    verificationState = 'ASK_KNOW';
                    renderParentKnowQuestion();
                    return;
                } else if (verificationState === 'ASK_KNOW') {
                    // ì´ë¯¸ ë Œë”ë§ë¨
                    return;
                } else if (verificationState === 'ASK_WHICH') {
                    // ì´ë¯¸ ë Œë”ë§ë¨
                    return;
                }
                // ê²€ì¦ ì™„ë£Œ í›„ finishTest í˜¸ì¶œì€ handleParent... í•¨ìˆ˜ì—ì„œ ë‹´ë‹¹
                return;
            }

            const q = questions[currentQuestionIndex];
            if (!q) {
                // Fallback
                finishTest();
                return;
            }

            const container = document.getElementById("question-container");
            container.innerHTML = `
        <div class="question-card fade-in">
            <div class="question-number">Q${q.id}</div>
            <div class="question-text">${q.text}</div>
            <div class="options-grid">
                ${q.options.map((opt, idx) => `
                    <button class="option-btn" onclick="selectOption(${currentQuestionIndex}, ${idx})">
                        ${opt.text}
                    </button>
                `).join('')}
            </div>
        </div>
    `;

            // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì—…ë°ì´íŠ¸
            updateProgressBar();
        }

        function selectOption(qIdx, oIdx) {
            const q = questions[qIdx];
            const selected = q.options[oIdx];

            // ì ìˆ˜ í•©ì‚°
            for (const [key, value] of Object.entries(selected.scores)) {
                // keyMapì„ í†µí•´ mok -> mokyang ë“±ìœ¼ë¡œ ë³€í™˜
                const realKey = keyMap[key] || keyMap['mokyang']; // fallback

                if (realKey === 'to') { // 'to' affects both Toyang and Toeum (mostly Toyang)
                    scores.toyang += value;
                    scores.toeum += value * 0.5;
                } else if (realKey === 'geum') { // 'geum' affects both 
                    scores.geumyang += value;
                    scores.geumeum += value;
                } else if (realKey === 'su') {
                    scores.suyang += value;
                    scores.sueum += value;
                } else if (realKey === 'mok') { // Just in case
                    scores.mokyang += value;
                    scores.mokeum += value;
                } else {
                    // Specific keys: mokyang, mokeum, geumeum, etc.
                    if (scores[realKey] !== undefined) {
                        scores[realKey] += value;
                    }
                }
            }

            currentQuestionIndex++;
            loadQuestion();
        }

        function renderParentKnowQuestion() {
            const container = document.getElementById("question-container");
            container.innerHTML = `
        <div class="question-card fade-in">
            <div class="question-number">ì¶”ê°€ ê²€ì¦</div>
            <div class="question-text">ë¶€ëª¨ë‹˜ì˜ ì²´ì§ˆì„ ì •í™•íˆ ì•Œê³  ê³„ì‹ ê°€ìš”?</div>
            <div class="options-grid">
                <button class="option-btn" onclick="handleParentKnow(true)">
                    ì˜ˆ, ì•Œê³  ìˆìŠµë‹ˆë‹¤.
                </button>
                <button class="option-btn" onclick="handleParentKnow(false)">
                    ì•„ë‹ˆì˜¤, ì˜ ëª¨ë¦…ë‹ˆë‹¤.
                </button>
            </div>
        </div>
    `;
            updateProgressBar();
        }

        function handleParentKnow(knows) {
            if (knows) {
                verificationState = 'ASK_WHICH';
                renderParentSelectQuestion();
            } else {
                finishTest();
            }
        }

        function renderParentSelectQuestion() {
            // í˜„ì¬ ì ìˆ˜ ê¸°ì¤€ ìƒìœ„ 4ê°œ ì¶”ì¶œ
            let scoreArray = [];
            for (const [key, val] of Object.entries(scores)) {
                scoreArray.push({ id: key, score: val });
            }
            // ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
            scoreArray.sort((a, b) => b.score - a.score);
            // ìƒìœ„ 4ê°œ
            const top4 = scoreArray.slice(0, 4);

            const container = document.getElementById("question-container");
            container.innerHTML = `
        <div class="question-card fade-in">
            <div class="question-number">ë¶€ëª¨ ì²´ì§ˆ ê²€ì¦</div>
            <div class="question-text">ë¶€ëª¨ë‹˜ì˜ ì²´ì§ˆì´ ì•„ë˜ ë¦¬ìŠ¤íŠ¸ì— ìˆìŠµë‹ˆê¹Œ?<br>
            <span style="font-size:16px; color:#666; font-weight:400;">(ë¶€ëª¨ë‹˜ ì¤‘ í•œ ë¶„ì´ë¼ë„ ìˆë‹¤ë©´ ì„ íƒí•´ì£¼ì„¸ìš”)</span>
            </div>
            <div class="options-grid">
                ${top4.map(item => `
                    <button class="option-btn" onclick="handleParentSelect('${item.id}')">
                        ${constitutionNames[item.id] || item.id}
                    </button>
                `).join('')}
                <button class="option-btn" style="background:#f5f5f5; color:#888;" onclick="handleParentSelect('NONE')">
                    ì´ ì¤‘ì— ì—†ìŒ (ë˜ëŠ” ëª¨ë¦„)
                </button>
            </div>
        </div>
    `;
            updateProgressBar();
        }

        function handleParentSelect(selectedId) {
            if (selectedId === 'NONE') {
                // ì•ˆë‚´ ë¬¸êµ¬ í‘œì‹œë¥¼ ìœ„í•œ í”Œë˜ê·¸ ì „ë‹¬
                finishTest({ geneticConsidered: true });
            } else {
                // ê°•ì œ ìˆœìœ„ ì¡°ì • (Override)
                // 1. í˜„ì¬ ìµœê³  ì ìˆ˜ ì°¾ê¸°
                let maxScore = 0;
                for (const val of Object.values(scores)) {
                    if (val > maxScore) maxScore = val;
                }

                // 2. ì„ íƒëœ ì²´ì§ˆì˜ ì ìˆ˜ë¥¼ Max + 1ë¡œ ì„¤ì •í•˜ì—¬ 1ë“± ë§Œë“¤ê¸°
                // (ë‹¨, ì´ë¯¸ ì••ë„ì  1ë“±ì¼ ìˆ˜ë„ ìˆì§€ë§Œ í™•ì‹¤íˆ í•˜ê¸° ìœ„í•´ +1)
                scores[selectedId] = maxScore + 1;

                finishTest();
            }
        }

        function updateProgressBar() {
            const bar = document.getElementById("progress-bar");
            const container = document.getElementById("progress-container");

            if (bar && container) {
                // ê²€ì¦ ë‹¨ê³„ì¼ ë•ŒëŠ” 100%ì— ê°€ê¹ê²Œ í‘œì‹œ
                let percent = 0;
                if (verificationState !== 'NONE') {
                    percent = 95; // ê²€ì¦ ì¤‘
                } else {
                    percent = ((currentQuestionIndex) / questions.length) * 100;
                }
                bar.style.width = `${percent}%`;
            }
        }

        function finishTest(options = {}) {
            // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ìƒì„±
            const params = new URLSearchParams();

            // 1. ì ìˆ˜ ë§¤í•‘ (V1, V2 ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ í‘œì¤€í™”)
            // V1 uses: m1score, m2score, t1score...
            // keyMap is: mokyang -> m1, mokeum -> m2 ...

            params.set('m1score', scores.mokyang);
            params.set('m2score', scores.mokeum);
            params.set('t1score', scores.toyang);
            params.set('t2score', scores.toeum);
            params.set('k1score', scores.geumyang);
            params.set('k2score', scores.geumeum);
            params.set('s1score', scores.suyang);
            params.set('s2score', scores.sueum);

            if (options.geneticConsidered) {
                params.set('genetic_var', 'true');
            }

            // Default to result_v2.html for V2 standalone
            window.location.href = `result_v2.html?${params.toString()}`;
        }
        // 1. Define Start Quiz Function
        window.startQuiz = function () {
            console.log("window.startQuiz called");
            try {
                // loadQuestion is in scope

                showSection('quiz');
                loadQuestion();
            } catch (e) {
                console.error("Quiz Start Error:", e);
                alert('í€´ì¦ˆ ì‹œì‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message);
            }
        };

        // 2. Safely Override finishTest
        // Check window.finishTest explicitly
        if (typeof window.finishTest === 'function') {
            const originalFinishTest = window.finishTest;

            window.finishTest = async function (options = {}) {
                console.log("V2 finishTest called", options);
                const resultParams = new URLSearchParams();

                // Ensure scores object is accessible
                if (typeof scores === 'undefined') {
                    console.error("Scores object missing!");
                    alert("ì ìˆ˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.");
                    return;
                }

                // Use real scores from new detailed quiz logic
                resultParams.set('m1score', scores.mokyang);
                resultParams.set('m2score', scores.mokeum);
                resultParams.set('t1score', scores.toyang);
                resultParams.set('t2score', scores.toeum);
                resultParams.set('k1score', scores.geumyang);
                resultParams.set('k2score', scores.geumeum);
                resultParams.set('s1score', scores.suyang);
                resultParams.set('s2score', scores.sueum);

                if (options && options.geneticConsidered) {
                    resultParams.set('genetic_var', 'true');
                }

                window.location.href = `result_v2.html?${resultParams.toString()}`;
            };
        } else {
            console.error("Warning: window.finishTest is not defined. quiz_logic.js might have failed to load.");
        }

        document.addEventListener("DOMContentLoaded", () => {
            // Attach Start Button Listener
            const startBtn = document.getElementById('btn-start-quiz');
            if (startBtn) {
                startBtn.addEventListener('click', () => {
                    // console.log("Start Button Clicked");
                    window.startQuiz();
                });
            }

            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('m1score')) {
                showSection('result');
                renderV2Result(urlParams);
            } else {
                showSection('intro');
            }
        });

        function showSection(name) {
            document.getElementById('intro-section').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'none';
            document.getElementById('result-section').style.display = 'none';
            if (name === 'intro') document.getElementById('intro-section').style.display = 'block';
            if (name === 'quiz') {
                document.getElementById('quiz-section').style.display = 'block';
                document.getElementById('progress-container').style.display = 'block';
            }
            if (name === 'result') document.getElementById('result-section').style.display = 'block';
        }

        function shareResult() {
            // ... share logic ... (keep existing implementation if not replacing entire block)
            // Shortening here for clarity of replacement
            const shareText = "ë‚˜ì˜ 8ì²´ì§ˆ MBTI ê²°ê³¼ëŠ”?\nhttp://localhost:8080/result_v2.html";
            if (navigator.share) {
                navigator.share({
                    title: 'ì²´ì§ˆ MBTI í…ŒìŠ¤íŠ¸',
                    text: 'ë‚´ ëª¸ì˜ ì„¤ê³„ë„ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                });
            }
        }


        function renderV2Result(urlParams) {
            // --- Coupang Partners Logic (Shared) ---
            const COUPANG_MAP = {
                'ì†Œê³ ê¸°': 'í•œìš°',
                'ì—°ê·¼': 'ì—°ê·¼ì¡°ë¦¼',
                'ë‘ë¶€': 'ë‘ë¶€ê³¼ì',
                'ë‹­ê³ ê¸°': 'ë‹­ê°€ìŠ´ì‚´',
                'ë¼ì§€ê³ ê¸°': 'í•œëˆ',
                'ë°€ê°€ë£¨': 'ìš°ë¦¬ë°€',
                'ê²¬ê³¼ë¥˜': 'í•˜ë£¨ê²¬ê³¼',
                'ë°°': 'ë‚˜ì£¼ë°°',
                'ìŒ€': 'ìœ ê¸°ë† ìŒ€',
                'ê°ì': 'ê°ì',
                'í˜¸ë°•': 'ë‹¨í˜¸ë°•',
                'ë¿Œë¦¬ì±„ì†Œ': 'ë¿Œë¦¬ì±„ì†Œ',
                'ì˜¤ë¦¬ê³ ê¸°': 'í›ˆì œì˜¤ë¦¬',
                'ë³´ë¦¬': 'ë³´ë¦¬ìŒ€',
                'ë°°ì¶”': 'ì•Œë°°ê¸° ë°°ì¶”',
                'ì˜¤ì´': 'ì˜¤ì´',
                'ë°”ë‹¤ìƒì„ ': 'ìë°˜ê³ ë“±ì–´',
                'íŒ¥': 'êµ­ì‚° íŒ¥',
                'ë³µì–´': 'ë³µì–´êµ­',
                'ëª¨ë“  ì¡°ê°œë¥˜': 'ì¡°ê°œê´€ì',
                'ë©”ë°€': 'ë©”ë°€ë©´',
                'í‘¸ë¥¸ ì ì±„ì†Œ': 'ìŒˆì±„ì†Œ',
                'ì½”ì½”ì•„': 'ì½”ì½”ì•„ íŒŒìš°ë”',
                'í˜„ë¯¸': 'ë°œì•„í˜„ë¯¸',
                'ë¯¸ì—­': 'ìë¥¸ë¯¸ì—­',
                'ìƒê°•': 'ìƒê°•ì²­',
                'ê³„í”¼': 'ê³„í”¼ê°€ë£¨',
                'ì°¹ìŒ€': 'ì°¹ìŒ€',
                'ê¿€': 'ì²œì—°ë²Œê¿€',
                'ì¸ì‚¼': 'í™ì‚¼ìŠ¤í‹±',
                'ë§ˆëŠ˜': 'ì˜ì„±ë§ˆëŠ˜'
            };

            function linkifyFood(foodString) {
                if (!foodString) return '';
                const COUPANG_ID = 'AF1234567'; // START: ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ID ìˆ˜ì •í•˜ëŠ” ê³³
                const items = foodString.split(',').map(s => s.trim());
                return items.map(item => {
                    let query = COUPANG_MAP[item] || item;
                    const searchUrl = `https://www.coupang.com/np/search?component=&q=${encodeURIComponent(query)}&channel=user&trackId=${COUPANG_ID}`;
                    return `<a href="${searchUrl}" target="_blank" style="color:#2e7d32; text-decoration:underline;">${item}</a>`;
                }).join(', ');
            }

            let r = [
                { id: 'mokyang', score: parseInt(urlParams.get('m1score') || 0), label: 'ëª©ì–‘ì²´ì§ˆ', icon: 'fa-tree' },
                { id: 'mokeum', score: parseInt(urlParams.get('m2score') || 0), label: 'ëª©ìŒì²´ì§ˆ', icon: 'fa-seedling' },
                { id: 'toyang', score: parseInt(urlParams.get('t1score') || 0), label: 'í† ì–‘ì²´ì§ˆ', icon: 'fa-fire' },
                { id: 'toeum', score: parseInt(urlParams.get('t2score') || 0), label: 'í† ìŒì²´ì§ˆ', icon: 'fa-volcano' },
                { id: 'geumyang', score: parseInt(urlParams.get('k1score') || 0), label: 'ê¸ˆì–‘ì²´ì§ˆ', icon: 'fa-wind' },
                { id: 'geumeum', score: parseInt(urlParams.get('k2score') || 0), label: 'ê¸ˆìŒì²´ì§ˆ', icon: 'fa-gem' },
                { id: 'suyang', score: parseInt(urlParams.get('s1score') || 0), label: 'ìˆ˜ì–‘ì²´ì§ˆ', icon: 'fa-snowflake' },
                { id: 'sueum', score: parseInt(urlParams.get('s2score') || 0), label: 'ìˆ˜ìŒì²´ì§ˆ', icon: 'fa-water' }
            ];
            r.sort((a, b) => b.score - a.score);
            const winnerId = r[0].id;

            const V2_DB = {
                'mokyang': {
                    name: 'ë¿Œë¦¬ ê¹Šì€ ë‚˜ë¬´',
                    type: 'ëª©ì–‘ì²´ì§ˆ (ê°„>í)',
                    icon: 'fa-tree', color: '#5d4037', sub: 'í¡ìˆ˜ë ¥ì´ ê°•í•œ ì €ìˆ˜ì§€í˜•',
                    keyword: 'ì €ì¥ & ëšì‹¬',
                    desc: 'ë‹¹ì‹ ì€ ì˜ì–‘ë¶„ì„ í¡ìˆ˜í•˜ì—¬ ì €ì¥í•˜ëŠ” ëŠ¥ë ¥ì´ íƒì›”í•œ ë‚˜ë¬´ì™€ ê°™ìŠµë‹ˆë‹¤. ë¿Œë¦¬ê°€ ê¹Šì–´ í”ë“¤ë¦¼ì´ ì—†ì§€ë§Œ, ì(í)ì„ í†µí•´ ë°œì‚°í•˜ëŠ” í˜ì€ ì•½í•©ë‹ˆë‹¤.',
                    caution: 'ë•€ì„ í ë»‘ ë‚´ëŠ” ë“±ì‚°ì´ë‚˜ ë‹¬ë¦¬ê¸°ê°€ ë³´ì•½ì…ë‹ˆë‹¤. ì±„ì‹ë³´ë‹¤ëŠ” ìœ¡ì‹ì´ ë§ìœ¼ë©°, ì‚¬ìš°ë‚˜ë„ ì¢‹ìŠµë‹ˆë‹¤.',
                    good: 'ì†Œê³ ê¸°, ë‹­ê³ ê¸°, ë¬´, ì—°ê·¼, ë°€ê°€ë£¨, ë°°, ê²¬ê³¼ë¥˜',
                    partner: 'ë†’ì´ ëœ¬ êµ¬ë¦„ (ê¸ˆì–‘ì²´ì§ˆ)',
                    p_reason: 'ì €ì¥í•˜ë ¤ëŠ” ë‹¹ì‹ (ê°„)ê³¼ ë°œì‚°í•˜ë ¤ëŠ” ìƒëŒ€(í)ê°€ ë§Œë‚˜ ì™„ë²½í•œ ê· í˜•ì„ ì´ë£¹ë‹ˆë‹¤. ì„œë¡œì˜ ë§‰íŒ ê³³ì„ ëš«ì–´ì£¼ëŠ” ê´€ê³„ì…ë‹ˆë‹¤.'
                },
                'mokeum': {
                    name: 'ê°ì„±ì ì¸ ë©êµ´',
                    type: 'ëª©ìŒì²´ì§ˆ (ë‹´>ëŒ€ì¥)',
                    icon: 'fa-seedling', color: '#43a047', sub: 'ë¯¼ê°í•˜ê²Œ ë°˜ì‘í•˜ëŠ” ì¥í˜•',
                    keyword: 'ê°ìˆ˜ì„± & ì†Œí™”ë ¥',
                    desc: 'ê¸¸ê²Œ ë»—ì–´ë‚˜ê°€ëŠ” ë©êµ´ì²˜ëŸ¼ ì†Œí™”ê¸°ê´€(ë‹´ë‚­/ì†Œì¥)ì˜ í˜ì´ ê°•í•©ë‹ˆë‹¤. ë¯¼ê°í•œ ëŒ€ì¥ì„ ë”°ëœ»í•˜ê²Œ ë³´í˜¸í•´ ì¤„ ê¸°ìš´ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                    caution: 'ì•„ë«ë°°ë¥¼ í•­ìƒ ë”°ëœ»í•˜ê²Œ í•˜ì„¸ìš”. ì•Œì½”ì˜¬ í•´ë…ë ¥ì´ ì•½í•˜ë‹ˆ ìˆ ì€ ë©€ë¦¬í•˜ê³ , ê²©í•œ ìš´ë™ìœ¼ë¡œ ë•€ì„ ë‚´ì„¸ìš”.',
                    good: 'ì†Œê³ ê¸°, ë¼ì§€ê³ ê¸°, ìŒ€, ê°ì, í˜¸ë°•, ë¿Œë¦¬ì±„ì†Œ',
                    partner: 'ë‹¨ë‹¨í•œ ë°”ìœ„ (ê¸ˆìŒì²´ì§ˆ)',
                    p_reason: 'ë‹¹ì‹ ì˜ ì˜ˆë¯¼í•œ ëŒ€ì¥(ì•½)ì„ ìƒëŒ€ì˜ ê°•í•œ ëŒ€ì¥(ê°•) ê¸°ìš´ì´ ë³´ì™„í•´ì¤ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ë¶€ë“œëŸ¬ì›€ê³¼ ìƒëŒ€ì˜ ë‹¨í˜¸í•¨ì´ ë§Œë‚˜ë©´ ì„œë¡œì—ê²Œ ì•ˆì •ê°ì„ ì¤ë‹ˆë‹¤.'
                },
                'toyang': {
                    name: 'í™œí™œ íƒ€ëŠ” ë¶ˆê½ƒ',
                    type: 'í† ì–‘ì²´ì§ˆ (ì·Œì¥>ì‹ ì¥)',
                    icon: 'fa-fire', color: '#e64a19', sub: 'ì—´ì´ ë§ê³  í™œë™ì ì¸ ìš©ê´‘ë¡œ',
                    keyword: 'ìŠ¤í”¼ë“œ & ì—´ì •',
                    desc: 'ë‹¹ì‹ ì€ ëœ¨ê²ê²Œ íƒ€ì˜¤ë¥´ëŠ” ë¶ˆê½ƒì…ë‹ˆë‹¤! ì†Œí™” ì—´ê¸°ê°€ ê°•í•´ ë¬´ì—‡ì´ë“  ë¹¨ë¦¬ ì²˜ë¦¬í•˜ì§€ë§Œ, ì‹ ì¥(ë¬¼)ì˜ ê¸°ìš´ì´ ì•½í•´ ì‰½ê²Œ ê±´ì¡°í•´ì§€ê³  ì§€ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    caution: 'ì„±ê²©ì´ ê¸‰í•´ì§€ì§€ ì•Šë„ë¡ ì—¬ìœ ë¥¼ ê°€ì§€ì„¸ìš”. ëƒ‰ìˆ˜ë§ˆì°°ì´ë‚˜ ìˆ˜ì˜ì´ ì¢‹ìœ¼ë©°, ì‚¬ìš°ë‚˜ë‚˜ ì—´ì´ ë‚˜ëŠ” ìŒì‹ì€ í”¼í•˜ì„¸ìš”.',
                    good: 'ë¼ì§€ê³ ê¸°, ì˜¤ë¦¬ê³ ê¸°, ë³´ë¦¬, ë°°ì¶”, ì˜¤ì´, ë°”ë‹¤ìƒì„ , ì–¼ìŒ',
                    partner: 'ì°¨ê°€ìš´ ì–¼ìŒ (ìˆ˜ì–‘ì²´ì§ˆ)',
                    p_reason: 'ëœ¨ê±°ìš´ ìš©ê´‘ë¡œ ê°™ì€ ë‹¹ì‹ (ì·Œì¥ ì—´)ì„ ìƒëŒ€ì˜ ì°¨ê°€ìš´ ì–¼ìŒë¬¼(ì‹ ì¥ í•œê¸°)ì´ ì‹í˜€ì¤ë‹ˆë‹¤. ê¸‰í•œ ë‹¹ì‹ ì„ ìƒëŒ€ì˜ ì¹¨ì°©í•¨ì´ ì¡ì•„ì£¼ëŠ” ì²œìƒì—°ë¶„ì…ë‹ˆë‹¤.'
                },
                'toeum': {
                    name: 'ëœ¨ê±°ìš´ ë§ˆê·¸ë§ˆ',
                    type: 'í† ìŒì²´ì§ˆ (ìœ„ì¥>ë°©ê´‘)',
                    icon: 'fa-volcano', color: '#fdd835', sub: 'í­ë°œì ì¸ ì†Œí™” ì—ë„ˆì§€',
                    keyword: 'ì§ê´€ & ì†Œí™”ë ¥',
                    desc: 'ìœ„ì¥ì˜ ì—´ê¸°ê°€ ê°€ì¥ ê°•ë ¥í•œ ë§ˆê·¸ë§ˆ íƒ€ì…ì…ë‹ˆë‹¤. ì—ë„ˆì§€ê°€ ìœ„ë¡œ ì†Ÿêµ¬ì¹˜ê¸° ì‰¬ì›Œ, ì°¨ê°€ìš´ ì„±ì§ˆì˜ ìŒì‹ìœ¼ë¡œ ì—´ì„ ë‚´ë ¤ì£¼ì–´ì•¼ í¸ì•ˆí•´ì§‘ë‹ˆë‹¤.',
                    caution: 'ì†Œí™”ë ¥ì´ ì¢‹ë‹¤ê³  ê³¼ì‹í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤. ì•½ë¬¼ ë¶€ì‘ìš©ì´ ì‹¬í•˜ë‹ˆ í•­ìƒì œ ë“± ì•½ë¬¼ ë³µìš©ì— íŠ¹íˆ ì£¼ì˜í•˜ì„¸ìš”.',
                    good: 'ë³´ë¦¬, ìŒ€, íŒ¥, ì˜¤ì´, ë¼ì§€ê³ ê¸°, ë³µì–´, ì–¼ìŒ',
                    partner: 'ì¡°ìš©í•œ í˜¸ìˆ˜ (ìˆ˜ìŒì²´ì§ˆ)',
                    p_reason: 'ìœ„ì¥ ì—´ì´ í­ë°œì ì¸ ë‹¹ì‹ ê³¼, ìœ„ì¥ì´ ì°¨ê°‘ê³  ë¬´ë ¥í•œ ìƒëŒ€ê°€ ë§Œë‚¬ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì˜ ë„˜ì¹˜ëŠ” ì—ë„ˆì§€ë¥¼ ìƒëŒ€ê°€ ë°›ì•„ì£¼ì–´ ì„œë¡œì˜ ê±´ê°•ì„ ì§€ì¼œì¤ë‹ˆë‹¤.'
                },
                'geumyang': {
                    name: 'ë†’ì´ ëœ¬ êµ¬ë¦„',
                    type: 'ê¸ˆì–‘ì²´ì§ˆ (í>ê°„)',
                    icon: 'fa-wind', color: '#90caf9', sub: 'ê°€ë³ê²Œ ë°œì‚°í•˜ëŠ” ê¸°ì²´í˜•',
                    keyword: 'ë°œì‚° & ì°½ì˜',
                    desc: 'ë‹¹ì‹ ì€ í•˜ëŠ˜ ë†’ì´ ë– ë‹¤ë‹ˆëŠ” êµ¬ë¦„ì²˜ëŸ¼ ê°€ë³ìŠµë‹ˆë‹¤. íì˜ ë°œì‚°í•˜ëŠ” í˜ì´ ê°•í•´ ì•„ì´ë””ì–´ê°€ ë„˜ì¹˜ì§€ë§Œ, ê°„(ì €ì¥)ì˜ í˜ì´ ì•½í•´ í˜„ì‹¤ ê°ê°ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    caution: 'ì§ë¬¼ì´ë‚˜ í–‡ë¹› ì•Œë ˆë¥´ê¸°ì— ì£¼ì˜í•˜ì„¸ìš”. ëª¨ë“  ìœ¡ì‹ì„ ëŠê³  ì±„ì‹ê³¼ ìƒì„ ì„ ë“œì…”ì•¼ í•˜ë©°, í™”ë¥¼ ë‚´ì§€ ë§ˆì„¸ìš”.',
                    good: 'ëª¨ë“  ì¡°ê°œë¥˜, ìŒ€, ë³´ë¦¬, ë©”ë°€, íŒ¥, í‘¸ë¥¸ ì ì±„ì†Œ, ì½”ì½”ì•„',
                    partner: 'ë¿Œë¦¬ ê¹Šì€ ë‚˜ë¬´ (ëª©ì–‘ì²´ì§ˆ)',
                    p_reason: 'ë°œì‚°ë§Œ í•˜ëŠ” ë‹¹ì‹ (í ê°•)ì„ ìƒëŒ€ì˜ ë¬µì§í•œ ì €ì¥ ëŠ¥ë ¥(ê°„ ê°•)ì´ ì¡ì•„ì¤ë‹ˆë‹¤. ë‘¥ë‘¥ ë– ë‹¤ë‹ˆëŠ” ë‹¹ì‹ ì„ ìƒëŒ€ê°€ í˜„ì‹¤ì˜ ë•…ì— ë‹¨ë‹¨íˆ ë¬¶ì–´ì¤„ ê²ƒì…ë‹ˆë‹¤.'
                },
                'geumeum': {
                    name: 'ë‹¨ë‹¨í•œ ë°”ìœ„',
                    type: 'ê¸ˆìŒì²´ì§ˆ (ëŒ€ì¥>ë‹´)',
                    icon: 'fa-gem', color: '#7986cb', sub: 'ëƒ‰ì² í•˜ê³  ì§ê´€ì ì¸ ê¸ˆì†í˜•',
                    keyword: 'ë¦¬ë”ì‹­ & ì›ì¹™',
                    desc: 'ë‹¹ì‹ ì€ ì œë ¨ëœ ê¸ˆì†ì´ë‚˜ ë‹¨ë‹¨í•œ ë°”ìœ„ ê°™ìŠµë‹ˆë‹¤. ëŒ€ì¥ì˜ ê¸°ìš´ì´ ê°•í•´ ì£¼ê´€ì´ ëšœë ·í•˜ê³  ëƒ‰ì² í•˜ì§€ë§Œ, ë‹´ë‚­ì´ ì•½í•´ ìœ¡ì‹ì„ í•˜ë©´ ëª¸ì´ ë¬´ê±°ì›Œì§‘ë‹ˆë‹¤.',
                    caution: 'ìœ¡ì‹ì€ ë§Œë³‘ì˜ ê·¼ì›ì…ë‹ˆë‹¤. ë¥ê²Œ ìƒí™œí•˜ê±°ë‚˜ ë•€ì„ ë§ì´ ë‚´ëŠ” ìš´ë™ì€ í”¼í•˜ê³ , ìˆ˜ì˜ì´ë‚˜ ê±·ê¸°ê°€ ì¢‹ìŠµë‹ˆë‹¤.',
                    good: 'ë©”ë°€, ìŒ€, ëª¨ë“  ì¡°ê°œ, ìƒì„ , í‘¸ë¥¸ ì ì±„ì†Œ, ì˜¤ì´, í¬ë„',
                    partner: 'ê°ì„±ì ì¸ ë©êµ´ (ëª©ìŒì²´ì§ˆ)',
                    p_reason: 'ë„ˆë¬´ ê°•í•˜ê³  ì°¨ê°€ìš´ ë‹¹ì‹ (ëŒ€ì¥ ê°•)ì„ ìƒëŒ€ì˜ ë¶€ë“œëŸ½ê³  ë”°ëœ»í•œ ê¸°ìš´(ë‹´ë‚­ ê°•)ì´ ê°ì‹¸ì¤ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ë…ë‹¨ì ì¸ ë©´ì„ ìƒëŒ€ê°€ ìœ ì—°í•˜ê²Œ í’€ì–´ì¤ë‹ˆë‹¤.'
                },
                'suyang': {
                    name: 'ì°¨ê°€ìš´ ì–¼ìŒ',
                    type: 'ìˆ˜ì–‘ì²´ì§ˆ (ì‹ ì¥>ì·Œì¥)',
                    icon: 'fa-snowflake', color: '#29b6f6', sub: 'ì°¨ê°‘ê³  ê¹ê¹í•œ ê²°ì •ì²´',
                    keyword: 'ì‹ ì¤‘ & ì™„ë²½',
                    desc: 'ë‹¹ì‹ ì€ íˆ¬ëª…í•˜ê³  ì°¨ê°€ìš´ ì–¼ìŒ ê²°ì •ì²´ì…ë‹ˆë‹¤. ì‹ ì¥ì˜ ìˆ˜ë ´í•˜ëŠ” ê¸°ìš´ì´ ê°•í•´ ì™„ë²½ì£¼ì˜ ì„±í–¥ì„ ë³´ì´ì§€ë§Œ, ì†Œí™” ê¸°ê´€(ì·Œì¥)ì˜ ì—´ê¸°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.',
                    caution: 'ë•€ì„ ë§ì´ í˜ë¦¬ë©´ ê¸°ìš´ì´ ë¹ ì§‘ë‹ˆë‹¤. ëƒ‰ìˆ˜ë§ˆì°°ì´ ì¢‹ìœ¼ë©°, ë„ˆë¬´ ì™„ë²½ì£¼ì˜ì ì¸ ì„±í–¥ìœ¼ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì§€ ë§ˆì„¸ìš”.',
                    good: 'í˜„ë¯¸, ê°ì, ë‹­ê³ ê¸°, ì—¼ì†Œê³ ê¸°, ë¯¸ì—­, ìƒê°•, ê³„í”¼, ì‚¬ê³¼',
                    partner: 'í™œí™œ íƒ€ëŠ” ë¶ˆê½ƒ (í† ì–‘ì²´ì§ˆ)',
                    p_reason: 'ë„ˆë¬´ ì°¨ê°‘ê³  ì‹ ì¤‘í•œ ë‹¹ì‹ (ì‹ ì¥ ê°•)ì—ê²Œ ìƒëŒ€ì˜ ëœ¨ê±°ìš´ ì—´ì •(ì·Œì¥ ê°•)ì´ í™œë ¥ì„ ì¤ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ë§ì„¤ì„ì„ ìƒëŒ€ê°€ ì‹œì›í•˜ê²Œ í•´ê²°í•´ ì¤„ ê²ƒì…ë‹ˆë‹¤.'
                },
                'sueum': {
                    name: 'ì¡°ìš©í•œ í˜¸ìˆ˜',
                    type: 'ìˆ˜ìŒì²´ì§ˆ (ë°©ê´‘>ìœ„ì¥)',
                    icon: 'fa-water', color: '#ba68c8', sub: 'ë¶€ë“œëŸ½ê²Œ ìˆ˜ë ´í•˜ëŠ” ì•¡ì²´í˜•',
                    keyword: 'ìœ ì—° & ì •ë¦¬',
                    desc: 'ë‹¹ì‹ ì€ ê³ ìš”í•˜ê³  ê¹Šì€ í˜¸ìˆ˜ì…ë‹ˆë‹¤. ë°©ê´‘ì˜ ê¸°ìš´ì´ ê°•í•´ ì°¸ì„ì„±ì´ ë§ì§€ë§Œ, ìœ„ì¥ì´ ê°€ì¥ ì°¨ê°€ì›Œ ì†Œí™”ë ¥ì´ ì•½í•˜ê³  ì—ë„ˆì§€ê°€ ë¶€ì¡±í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.',
                    caution: 'ì†Œí™”ê¸°ê°€ ê°€ì¥ ì•½í•©ë‹ˆë‹¤. ì ˆëŒ€ ê³¼ì‹í•˜ì§€ ë§ê³  ì†Œì‹í•˜ì„¸ìš”. ë•€ì„ ë‚´ëŠ” ì‚¬ìš°ë‚˜ëŠ” í”¼í•˜ê³  ëª¸ì„ ë”°ëœ»í•˜ê²Œ í•˜ì„¸ìš”.',
                    good: 'ì°¹ìŒ€, ê°ì, ë‹­ê³ ê¸°, ê¿€, ì¸ì‚¼, ìƒê°•, ê³„í”¼, ë§ˆëŠ˜',
                    partner: 'ëœ¨ê±°ìš´ ë§ˆê·¸ë§ˆ (í† ìŒì²´ì§ˆ)',
                    p_reason: 'ìœ„ì¥ì´ ë„ˆë¬´ ì°¨ê°€ìš´ ë‹¹ì‹ (ìœ„ì¥ ì•½)ì—ê²Œ, ìœ„ì¥ ì—´ì´ ë„˜ì¹˜ëŠ” ìƒëŒ€(ìœ„ì¥ ê°•)ëŠ” ìµœê³ ì˜ ë‚œë¡œì…ë‹ˆë‹¤. í•¨ê»˜ ì‹ì‚¬í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì†Œí™”ê°€ ì˜ ë  ê²ƒì…ë‹ˆë‹¤.'
                }
            };

            const data = V2_DB[winnerId] || V2_DB['mokyang'];

            // UI Update
            const typeNameEl = document.getElementById('v2-type-name');
            typeNameEl.innerText = data.type;
            typeNameEl.style.color = data.color;
            typeNameEl.style.border = `2px solid ${data.color}`;
            // Background tint for type name
            typeNameEl.style.backgroundColor = data.color + '10';

            document.getElementById('v2-char-name').innerText = data.name;
            document.getElementById('v2-char-sub').innerText = data.sub;
            document.getElementById('v2-keyword').innerText = '#' + data.keyword;
            document.getElementById('v2-desc').innerText = data.desc;

            document.getElementById('v2-partner').innerText = data.partner;
            document.getElementById('v2-partner-reason').innerText = data.p_reason;
            // Caution Text Update
            document.getElementById('v2-caution').innerText = data.caution || "íŠ¹ì´ì‚¬í•­ ì—†ìŒ";

            // Food List Update (NEW)
            const foodListEl = document.getElementById('v2-food-list');
            if (foodListEl) {
                // Linkify the food list
                const linkedFoods = linkifyFood(data.good);
                foodListEl.innerHTML = linkedFoods;
            }

            // Icon Style
            const iconBg = document.getElementById('v2-icon-bg');
            iconBg.style.backgroundColor = data.color + '20';
            iconBg.style.borderColor = data.color;

            const iconEl = document.getElementById('v2-icon-el');
            iconEl.className = `fa-solid ${data.icon}`;
            iconEl.style.color = data.color;

            // Render Ranking Table
            const rankingList = document.getElementById('v2-ranking-list');
            let rankingHtml = '';
            r.forEach((item, idx) => {
                const rank = idx + 1;
                const isFirst = idx === 0;
                rankingHtml += `
                    <div class="rank-row ${isFirst ? 'rank-1' : ''}">
                        <div class="rank-num">${rank}</div>
                        <div class="rank-name">
                             ${isFirst ? '<i class="fa-solid fa-crown" style="color:#ffd700; margin-right:5px;"></i>' : ''}
                             ${item.label}
                        </div>
                        <div class="rank-score">${item.score}ì </div>
                    </div>
                `;
            });
            rankingList.innerHTML = rankingHtml;

            // ìœ ì „ì  ë³€ìˆ˜ ê³ ë ¤ ì•ˆë‚´ ë¬¸êµ¬ ì¶”ê°€
            // urlParams is already passed as argument
            if (urlParams.get('genetic_var') === 'true' || urlParams.get('info') === 'genetic') {
                const infoDiv = document.createElement('div');
                infoDiv.className = 'fade-in';
                infoDiv.style.marginTop = '15px';
                infoDiv.style.padding = '15px';
                infoDiv.style.backgroundColor = '#eef6fc';
                infoDiv.style.border = '1px solid #d1e3f6';
                infoDiv.style.borderRadius = '12px';
                infoDiv.style.fontSize = '13px';
                infoDiv.style.color = '#1565c0';
                infoDiv.style.lineHeight = '1.5';
                infoDiv.style.textAlign = 'center';
                infoDiv.innerHTML = '<i class="fa-solid fa-dna" style="margin-right:6px;"></i> ìœ ì „ì  ë³€ìˆ˜ë¥¼ ê³ ë ¤í–ˆìœ¼ë‚˜,<br>í˜„ì¬ ì„¤ë¬¸ ì‘ë‹µ ê²°ê³¼ê°€ ê°€ì¥ ë†’ì€ ì²´ì§ˆë¡œ ì§„ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.';

                rankingList.appendChild(infoDiv);
            }

            // --- Product Recommendation Logic (New) ---
            const targetConstitutions = ['mokyang', 'mokeum', 'suyang', 'sueum'];
            const productLink = targetConstitutions.includes(winnerId)
                ? 'https://link.coupang.com/a/doFZ3N'
                : '#';

            const buttonAction = productLink === '#' ? "alert('ì¤€ë¹„ì¤‘ì¸ ìƒí’ˆì…ë‹ˆë‹¤.'); return false;" : "";

            // Check if recommendation section already exists to prevent duplicate
            let recommendSection = document.getElementById('v2-recommend-section');
            if (!recommendSection) {
                recommendSection = document.createElement('div');
                recommendSection.id = 'v2-recommend-section';
                recommendSection.style.marginTop = '24px';
                // Append to the Card (v2-result-card)
                const card = document.getElementById('v2-result-card');
                if (card) card.appendChild(recommendSection);
            }

            // V2 Button Style (Playful & Pop)
            // V2 Button Style (Playful & Pop)
            recommendSection.innerHTML = `
                <a href="${productLink}" target="_blank" onclick="${buttonAction}" 
                   style="display:block; width:100%; background:#FF5252; color:white; font-family:'Jua', sans-serif; font-size:18px; padding:18px; border-radius:18px; text-decoration:none; box-shadow:0 6px 0 #D32F2F; transform:translateY(0); transition:all 0.1s; position:relative;">
                   <i class="fa-solid fa-gift" style="margin-right:8px;"></i> ${r[0].label} ë§ì¶¤ ì¶”ì²œ ìƒí’ˆ ë³´ëŸ¬ê°€ê¸°
                </a>
                <p style="font-size: 10px; color: #ccc; margin-top: 12px; line-height: 1.4;">
                    ì´ í¬ìŠ¤íŒ…ì€ ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, ì´ì— ë”°ë¥¸ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.
                </p>
            `;

            // Append Coupang Partners Disclosure to Footer
            // V2 has a centered text div at the bottom: id="result-section" -> div style="text-align:center..."
            // Let's create a dedicated element for legal text if not exists
            if (!document.getElementById('coupang-disclosure')) {
                const disclosure = document.createElement('div');
                disclosure.id = 'coupang-disclosure';
                disclosure.style.textAlign = 'center';
                disclosure.style.fontSize = '11px';
                disclosure.style.color = '#aaa';
                disclosure.style.marginTop = '20px';
                disclosure.style.marginBottom = '40px';
                disclosure.innerHTML = 'ì´ í¬ìŠ¤íŒ…ì€ ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ, ì´ì— ë”°ë¥¸ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤.<br><!-- ID: [ì‚¬ìš©ì ID ì…ë ¥] -->';

                // Append before the very bottom text
                const resultSection = document.getElementById('result-section');
                if (resultSection) {
                    resultSection.appendChild(disclosure);
                }
            }
        }

        function saveV2Image() {
            const target = document.getElementById('v2-result-card');
            if (!target) return;

            // Scroll to target to ensure visibility for canvas
            target.scrollIntoView({ block: "center" });

            html2canvas(target, {
                useCORS: true,
                scale: 2,
                backgroundColor: "#ffffff",
                borderRadius: 24
            }).then(canvas => {
                const link = document.createElement('a');
                const name = document.getElementById('v2-char-name').innerText || 'Result';
                link.download = `${name}_ì¹´ë“œ.png`;
                link.href = canvas.toDataURL();
                link.click();
            }).catch(err => {
                console.error("V2 Capture failed:", err);
                alert("ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            });
        }
    </script>
</body>

</html>